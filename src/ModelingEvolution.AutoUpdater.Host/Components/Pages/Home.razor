@page "/"
@using ModelingEvolution.AutoUpdater
@using ModelingEvolution.AutoUpdater.Host.Components.Shared
@inject UpdateService updateService
@inject IConfiguration Configuration
<PageTitle>Home</PageTitle>

<PackageList ErrorMessage="@_lastError" />

<MudButton Variant="Variant.Filled" Size="Size.Large" Class="ma-4" OnClick="@OnClick">Update all</MudButton>

<VpnControl />

<LoggerViewer />

@code {
    private string _lastError = string.Empty;
    
    private async Task OnClick(MouseEventArgs e)
    {
        try
        {
            _lastError = string.Empty;
            await updateService.UpdateAllAsync();
        }
        catch (UpdateFailedException ex)
        {
            _lastError = ex.Message;
        }
    }
}